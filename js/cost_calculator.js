!function(e){"use strict";const t=.2,i="DEV-web",n={name:"Mistral Pro Reno",address:"9 rue Anatole de la Forge",city:"75017 Paris France",tva:"FR74851558882",phone:"07 55 18 89 37",email:"contact@mistral-renov.com",capital:"1000 €",rcs:"85155888200029 RCS Paris",ape:"4120A",assurance:"HOKEN ASSURANCE - 25 Rue Marbeuf, 75008 Paris"};let r=null;function o(){let i=0;i+=a("wc"),i+=a("lavabo"),i+=a("douche"),i+=a("baignoire"),i+=150*l("robinets"),i+=a("ballon-eau"),i+=a("adoucisseur"),i+=35*l("tuyauterie"),i+=s("tableau-electrique"),i+=80*l("points-lumineux"),i+=60*l("prises"),i+=50*l("interrupteurs"),i+=300*l("radiateurs"),i+=l("murs-peinture")*s("type-peinture-murs"),i+=18*l("plafonds-peinture"),i+=15*l("boiseries"),i+=80*l("portes-peinture"),i+=60*l("fenetres-peinture"),i+=8*l("plinthes-peinture"),i+=25*l("enduit-murs"),i+=12*l("depose-papier"),i+=10*l("primaire-peinture"),i+=l("parquet-stratifie")*s("gamme-parquet-stratifie"),i+=l("parquet-massif")*s("gamme-parquet-massif"),i+=l("parquet-contrecolle")*s("gamme-parquet-contrecolle"),i+=l("carrelage-sol")*s("gamme-carrelage-sol"),i+=l("lino-sol")*s("gamme-lino-sol"),i+=l("dalle-pvc")*s("gamme-dalle-pvc"),i+=l("faience-mur")*s("gamme-faience-mur"),i+=l("credence-mur")*s("gamme-credence-mur"),i+=15*l("depose-sol"),i+=45*l("reagreage"),i+=45*l("chape-sol"),i+=15*l("primaire-sol"),i+=l("cuisine")*s("gamme-cuisine"),i+=500*l("placards"),i+=a("dressing"),i+=a("bibliotheque"),i+=s("mur-porteur"),i+=45*l("cloisons"),i+=70*l("dalle-beton"),i+=80*l("demolition"),i+=1800*l("clim-unites"),i+=s("pac"),i+=s("chaudiere"),i+=s("vmc"),i+=a("poele-bois"),i+=a("plancher-chauffant"),i+=35*l("combles"),i+=45*l("murs-int"),i+=120*l("ite"),i+=1800*l("extension"),i+=50*l("terrassement"),i+=200*l("fondations"),i+=180*l("charpente"),i+=s("pack-sdb"),i+=55*l("carrelage-sdb"),i+=a("meuble-sdb"),i+=a("colonne-douche"),i+=s("ravalement"),i+=40*l("peinture-facade"),i+=350*l("portes-int"),i+=s("escalier"),i+=450*l("fenetres"),i+=s("baie-vitree"),i+=350*l("volets"),i+=180*l("charpente-couv"),i+=120*l("toiture"),i+=80*l("zinguerie"),i+=800*l("velux"),i+=35*l("placo-murs"),i+=40*l("placo-cloisons"),i+=45*l("faux-plafond"),i+=18*l("enduit-lissage"),i+=8*l("bandes-joints"),i+=a("placo-phonique"),i+=a("placo-hydrofuge");const n=i*t,r=i+n;e("#subtotal").text(c(i)),e("#vat").text(c(n)),e("#total").text(c(r))}function a(t){const i=e("#"+t);return i.is(":checked")&&parseFloat(i.data("price"))||0}function l(t){return parseFloat(e("#"+t).val())||0}function s(t){return parseFloat(e("#"+t).val())||0}function c(e){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function u(e){return Math.round(e).toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")+" EUR"}function d(t){const i=e('label[for="'+t+'"]');if(!i.length)return"u";const n=i.text();return n.includes("(m²)")||n.includes("m²")?"m2":n.includes("(ml)")||n.includes("ml")?"ml":n.includes("(m³)")||n.includes("m³")?"m3":"u"}function p(){const t=e("#client-nom").val().trim(),i=e("#client-adresse").val().trim(),n=e("#client-cp").val().trim(),r=e("#client-ville").val().trim(),o=e("#client-tel").val().trim();if(!(t&&i&&n&&r&&o))return alert("Veuillez remplir toutes les informations client obligatoires (*) avant de générer le devis."),e("html, body").animate({scrollTop:e(".client-form").offset().top-100},500),void(t?o?i?n?r||e("#client-ville").focus():e("#client-cp").focus():e("#client-adresse").focus():e("#client-tel").focus():e("#client-nom").focus());if(!/^[0-9]{5}$/.test(n))return alert("Le code postal doit contenir exactement 5 chiffres."),void e("#client-cp").focus();const a=_();if(0===a.length)return void alert("Veuillez sélectionner au moins un élément pour générer le devis.");const l=e("#subtotal").text(),s=e("#vat").text(),c=e("#total").text(),u=parseFloat(l.replace(/[^\d,]/g,"").replace(",","."))||0,d=parseFloat(s.replace(/[^\d,]/g,"").replace(",","."))||0,p=parseFloat(c.replace(/[^\d,]/g,"").replace(",","."))||0;try{h(a,u,d,p,!1)}catch(e){console.error("Erreur génération PDF:",e),alert("Une erreur est survenue lors de la génération du PDF. Veuillez réessayer.")}}function m(){const t=e("#client-nom").val().trim(),i=e("#client-adresse").val().trim(),n=e("#client-cp").val().trim(),r=e("#client-ville").val().trim(),o=e("#client-tel").val().trim();if(!(t&&i&&n&&r&&o))return alert("Veuillez remplir toutes les informations client obligatoires (*) avant d'imprimer le devis."),e("html, body").animate({scrollTop:e(".client-form").offset().top-100},500),void(t?o?i?n?r||e("#client-ville").focus():e("#client-cp").focus():e("#client-adresse").focus():e("#client-tel").focus():e("#client-nom").focus());if(!/^[0-9]{5}$/.test(n))return alert("Le code postal doit contenir exactement 5 chiffres."),void e("#client-cp").focus();const a=_();if(0===a.length)return void alert("Veuillez sélectionner au moins un élément pour imprimer le devis.");const l=e("#subtotal").text(),s=e("#vat").text(),c=e("#total").text(),u=parseFloat(l.replace(/[^\d,]/g,"").replace(",","."))||0,d=parseFloat(s.replace(/[^\d,]/g,"").replace(",","."))||0,p=parseFloat(c.replace(/[^\d,]/g,"").replace(",","."))||0;try{h(a,u,d,p,!0)}catch(e){console.error("Erreur impression PDF:",e),alert("Une erreur est survenue lors de l'impression du PDF. Veuillez réessayer.")}}function _(){const e=[];return f(e,"wc","Plomberie"),f(e,"lavabo","Plomberie"),f(e,"douche","Plomberie"),f(e,"baignoire","Plomberie"),v(e,"robinets",150,"Plomberie"),f(e,"ballon-eau","Plomberie"),f(e,"adoucisseur","Plomberie"),v(e,"tuyauterie",35,"Plomberie"),b(e,"tableau-electrique","Electricite"),v(e,"points-lumineux",80,"Electricite"),v(e,"prises",60,"Electricite"),v(e,"interrupteurs",50,"Electricite"),v(e,"radiateurs",300,"Electricite"),g(e,"murs-peinture","type-peinture-murs","Peinture"),v(e,"plafonds-peinture",18,"Peinture"),v(e,"boiseries",15,"Peinture"),v(e,"portes-peinture",80,"Peinture"),v(e,"fenetres-peinture",60,"Peinture"),v(e,"plinthes-peinture",8,"Peinture"),v(e,"enduit-murs",25,"Peinture"),v(e,"depose-papier",12,"Peinture"),v(e,"primaire-peinture",10,"Peinture"),g(e,"parquet-stratifie","gamme-parquet-stratifie","Revetement"),g(e,"parquet-massif","gamme-parquet-massif","Revetement"),g(e,"parquet-contrecolle","gamme-parquet-contrecolle","Revetement"),g(e,"carrelage-sol","gamme-carrelage-sol","Revetement"),g(e,"lino-sol","gamme-lino-sol","Revetement"),g(e,"dalle-pvc","gamme-dalle-pvc","Revetement"),g(e,"faience-mur","gamme-faience-mur","Revetement"),g(e,"credence-mur","gamme-credence-mur","Revetement"),v(e,"depose-sol",15,"Revetement"),v(e,"reagreage",45,"Revetement"),v(e,"chape-sol",45,"Revetement"),v(e,"primaire-sol",15,"Revetement"),g(e,"cuisine","gamme-cuisine","Meuble"),v(e,"placards",500,"Meuble"),f(e,"dressing","Meuble"),f(e,"bibliotheque","Meuble"),b(e,"mur-porteur","Maconnerie"),v(e,"cloisons",45,"Maconnerie"),v(e,"dalle-beton",70,"Maconnerie"),v(e,"demolition",80,"Maconnerie"),v(e,"clim-unites",1800,"Climatisation"),b(e,"pac","Climatisation"),b(e,"chaudiere","Climatisation"),b(e,"vmc","Climatisation"),f(e,"poele-bois","Climatisation"),f(e,"plancher-chauffant","Climatisation"),v(e,"combles",35,"Isolation"),v(e,"murs-int",45,"Isolation"),v(e,"ite",120,"Isolation"),v(e,"extension",1800,"Construction"),v(e,"terrassement",50,"Construction"),v(e,"fondations",200,"Construction"),v(e,"charpente",180,"Construction"),b(e,"pack-sdb","Salle de Bain"),v(e,"carrelage-sdb",55,"Salle de Bain"),f(e,"meuble-sdb","Salle de Bain"),f(e,"colonne-douche","Salle de Bain"),b(e,"ravalement","Peinture Exterieure"),v(e,"peinture-facade",40,"Peinture Exterieure"),v(e,"portes-int",350,"Menuiserie Interieure"),b(e,"escalier","Menuiserie Interieure"),v(e,"fenetres",450,"Menuiserie Exterieure"),b(e,"baie-vitree","Menuiserie Exterieure"),v(e,"volets",350,"Menuiserie Exterieure"),v(e,"charpente-couv",180,"Couverture"),v(e,"toiture",120,"Couverture"),v(e,"zinguerie",80,"Couverture"),v(e,"velux",800,"Couverture"),v(e,"placo-murs",35,"Platrerie"),v(e,"placo-cloisons",40,"Platrerie"),v(e,"faux-plafond",45,"Platrerie"),v(e,"enduit-lissage",18,"Platrerie"),v(e,"bandes-joints",8,"Platrerie"),f(e,"placo-phonique","Platrerie"),f(e,"placo-hydrofuge","Platrerie"),e}function f(t,i,n){const r=e("#"+i);if(r.is(":checked")){const e=r.data("label")||r.parent().text().trim().split("(")[0].trim(),i=parseFloat(r.data("price"))||0;t.push({category:n,description:x(e),quantity:1,unit:"u",unitPrice:i,total:i})}}function v(t,i,n,r){const o=l(i);if(o>0){const a=e("#"+i).data("label")||e('label[for="'+i+'"]').text().split("(")[0].trim();t.push({category:r,description:x(a),quantity:o,unit:d(i),unitPrice:n,total:o*n})}}function b(t,i,n){const r=s(i);if(r>0){const o=e("#"+i),a=o.find("option:selected").text(),l=o.data("label")||e('label[for="'+i+'"]').text().trim();t.push({category:n,description:x(l+" - "+a),quantity:1,unit:"u",unitPrice:r,total:r})}}function g(t,i,n,r){const o=l(i),a=s(n);if(o>0&&a>0){const l=e("#"+i).data("label")||e('label[for="'+i+'"]').text().split("(")[0].trim(),s=e("#"+n).find("option:selected").text();t.push({category:r,description:x(l+" - "+s),quantity:o,unit:d(i),unitPrice:a,total:o*a})}}function y(t,i,n,r,o){const a=l(i),c=s(r),u=e("#"+n).val();if(a>0&&u&&"0"!==u){const l=e("#"+i).data("label")||e('label[for="'+i+'"]').text().split("(")[0].trim(),s=e("#"+n).find("option:selected").text(),f=e("#"+r).find("option:selected").text();t.push({category:o,description:x(l+" - "+s+" - "+f),quantity:a,unit:d(i),unitPrice:c,total:a*c})}}function x(e){return e.replace(/€/g,"EUR").replace(/²/g,"2").replace(/³/g,"3").replace(/–/g,"-").replace(/'/g,"'").replace(/"/g,'"').replace(/"/g,'"').trim()}function h(t,o,a,l,s=!1){const{jsPDF:d}=window.jspdf,p=new d,m=new Date,_=m.toLocaleDateString("fr-FR"),f=function(){const e=(new Date).getFullYear(),t=String(Date.now()).slice(-6);return`${i}-${e}-${t}`}();let v=15;if(r)try{p.addImage(r,"PNG",15,v,35,35)}catch(e){F(p,v)}else F(p,v);p.setFontSize(16),p.setTextColor(0,51,204),p.setFont(void 0,"bold"),p.text(n.name,55,v+8),v+=13,p.setFontSize(9),p.setTextColor(0,0,0),p.setFont(void 0,"normal"),p.text(n.address,55,v),v+=4,p.text(n.city,55,v),v+=4,p.text("TVA N "+n.tva,55,v),v+=4,p.setTextColor(0,51,204),p.setFont(void 0,"bold"),p.text("Tel : "+n.phone,55,v),v+=4,p.setTextColor(0,0,0),p.setFont(void 0,"normal"),p.text("Email : "+n.email,55,v),p.setFontSize(28),p.setTextColor(74,144,226),p.setFont(void 0,"bold"),p.text("Devis",165,20),v=28,p.setFontSize(9),p.setTextColor(0,0,0),p.setFont(void 0,"normal"),p.text("N "+f,150,v),v+=4,p.text("En date du : "+_,150,v),v+=4;const b=new Date(m);b.setDate(b.getDate()+30),p.text("Valable jusqu'au : "+b.toLocaleDateString("fr-FR"),150,v),v+=4;const g=e("#client-debut-travaux").val(),h=e("#client-duree-travaux").val(),C=g?new Date(g).toLocaleDateString("fr-FR"):"__________",y=h||"_____";p.text("Debut des travaux le : "+C,150,v),v+=4,p.text("Duree estimee a : "+y+" jours",150,v),v=58,p.setDrawColor(74,144,226),p.setLineWidth(.5),p.line(20,v,190,v),v+=7,p.setFontSize(11),p.setFont(void 0,"bold"),p.text("CLIENT",20,v),v+=6,p.setFontSize(9),p.setFont(void 0,"normal");const P=x(e("#client-nom").val()||"________________________________"),T=x(e("#client-adresse").val()||"________________________________"),E=e("#client-cp").val()||"",S=e("#client-ville").val()||"",D=e("#client-tel").val()||"________________",w=e("#client-email").val()||"________________",I=E&&S?E+" "+S:"________________________________";p.text("Nom et Prenom : "+P,20,v),v+=5,p.text("Adresse : "+T,20,v),v+=5,p.text("Code Postal / Ville : "+I,20,v),v+=5,p.text("Telephone : "+D+"  Email : "+w,20,v),v+=7,p.setDrawColor(200,200,200),p.setLineWidth(.3),p.line(20,v,190,v);const z={};t.forEach(function(e){z[e.category]||(z[e.category]=[]),z[e.category].push(e)}),v+=7,p.setFontSize(9),p.setFont(void 0,"bold"),p.setFillColor(74,144,226),p.rect(20,v-4,170,6,"F"),p.setTextColor(255,255,255),p.text("N",22,v),p.text("DESIGNATION",35,v),p.text("QTE",120,v),p.text("UNITE",135,v),p.text("PRIX U.",168,v,{align:"right"}),p.text("TOTAL HT",185,v,{align:"right"}),v+=2,p.setTextColor(0,0,0),p.setFont(void 0,"normal");let R=1;Object.keys(z).forEach(function(e){v+=6,v>250&&(p.addPage(),v=20),p.setFont(void 0,"bold"),p.setFontSize(9),p.setFillColor(240,240,240),p.rect(20,v-3,170,5,"F"),p.text(e.toUpperCase(),22,v),p.setFont(void 0,"normal"),z[e].forEach(function(e){v+=5,v>250&&(p.addPage(),v=20),p.setFontSize(8),p.text(R.toString(),22,v);const t=p.splitTextToSize(e.description,70);p.text(t,35,v),p.text(e.quantity.toString(),122,v),p.text(e.unit,137,v),p.text(e.unitPrice.toFixed(0)+" EUR",168,v,{align:"right"}),p.text(e.total.toFixed(0)+" EUR",185,v,{align:"right"}),t.length>1&&(v+=3.5*(t.length-1)),R++})}),v+=10,v>230&&(p.addPage(),v=20),p.setDrawColor(74,144,226),p.setLineWidth(.5),p.line(20,v,190,v),v+=7;const M=v;p.setTextColor(0,0,0),p.setFont(void 0,"bold"),p.setFontSize(10),p.text("Conditions de paiement",20,v),v+=5,p.setFont(void 0,"normal"),p.setFontSize(8);const k=Math.round(.3*l),U=l-k;p.text("Acompte de 30 % a la signature soit "+u(k)+" TTC",20,v),v+=4,p.text("Reste a facturer : "+u(U)+" TTC",20,v),v+=4,p.text("Methodes de paiement acceptees : Virement bancaire.",20,v),v+=6,p.setFontSize(7),p.text("Devis etabli a titre gratuit.",20,v),v+=3,p.text("- Factures de situations en fonction avancees du chantier",25,v),v+=3,p.text("- Solde en fin de chantier.",25,v),v=M,p.setFontSize(10),p.setFont(void 0,"normal"),p.setTextColor(0,0,0),p.text("Total net HT",125,v),p.text(u(o),188,v,{align:"right"}),v+=5,p.text("TVA 20,00 %",125,v),p.text(u(a),188,v,{align:"right"}),v+=5,p.setFont(void 0,"bold"),p.text("Total TTC",125,v),p.text(u(l),188,v,{align:"right"}),v+=8,p.setFontSize(12),p.setFillColor(74,144,226),p.rect(120,v-5,70,9,"F"),p.setTextColor(255,255,255),p.text("NET A PAYER",125,v),p.text(u(l),188,v,{align:"right"});const A=p.internal.getNumberOfPages();for(let e=1;e<=A;e++)p.setPage(e),p.setFontSize(7),p.setTextColor(100,100,100),p.text("Capital de "+x(n.capital)+" - "+n.rcs+" - APE : "+n.ape,105,285,{align:"center"}),p.text("Garantie decennale - "+n.assurance,105,289,{align:"center"}),p.setFontSize(8),p.text("Page "+e+" / "+A,190,289,{align:"right"});if(s||function(t,i,n){try{const r=e("#client-nom").val().trim(),o=e("#client-tel").val().trim(),a=e("#client-email").val().trim(),l=t.output("datauristring").split(",")[1],s="devis-mistral-pro-reno-"+i+".pdf",u=c(n);fetch(`${"https://aejbbxwfqmyleegxemvn.supabase.co"}/functions/v1/send-devis-pdf`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFlamJieHdmcW15bGVlZ3hlbXZuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1MTU0NDQsImV4cCI6MjA4MjA5MTQ0NH0.ainysR4WzVdVrUvoG3IwIfbK8iIigxV3YSVzDiCjA74"}`},body:JSON.stringify({pdfBase64:l,filename:s,client_nom:r,client_tel:o,client_email:a||"",total_ttc:u})}).then(e=>{e.ok?console.log("PDF envoyé par email avec succès"):console.warn("Erreur lors de l'envoi du PDF par email")}).catch(e=>{console.warn("Erreur lors de l'envoi du PDF par email:",e)})}catch(e){console.warn("Erreur lors de la préparation de l'email:",e)}}(p,f,l),s){const e=p.output("blob"),t=URL.createObjectURL(e),i=window.open(t,"_blank");i?i.onload=function(){i.print(),setTimeout(function(){URL.revokeObjectURL(t)},1e3)}:(alert("Impossible d'ouvrir la fenêtre d'impression. Veuillez vérifier les paramètres de votre navigateur."),URL.revokeObjectURL(t))}else p.save("devis-mistral-pro-reno-"+f+".pdf")}function F(e,t){e.setDrawColor(0,51,204),e.setLineWidth(1.5),e.circle(32,t+17,16,"S"),e.setFontSize(12),e.setTextColor(0,51,204),e.setFont(void 0,"bold"),e.text("MPR",24,t+20)}e(document).ready(function(){!function(){const e=new Image;e.crossOrigin="anonymous",e.onload=function(){try{const t=document.createElement("canvas");t.width=e.width,t.height=e.height;t.getContext("2d").drawImage(e,0,0),r=t.toDataURL("image/png")}catch(e){console.warn("Erreur conversion logo:",e)}},e.onerror=function(){console.warn("Logo non trouvé, utilisation du logo par défaut dans le PDF")},e.src="images/logo.png"}(),e('input[type="range"]').on("input",function(){const t=e(this).attr("id"),i=e("#"+t+"-number");i.length&&i.val(e(this).val()),o()}),e('input[type="number"].number-input').on("input",function(){const t=e(this).attr("id").replace("-number",""),i=e("#"+t);if(!i.length)return;const n=parseInt(i.attr("max"))||999,r=parseInt(i.attr("min"))||0;let a=parseInt(e(this).val())||0;a=Math.max(r,Math.min(n,a)),e(this).val(a),i.val(a),o()}),e('input[type="number"].number-input').on("blur",function(){if(""===e(this).val()){e(this).val(0);const t=e(this).attr("id").replace("-number","");e("#"+t).val(0),o()}}),e(".tab-button").on("click",function(){const t=e(this).data("tab");e(".tab-button").removeClass("active").attr("aria-selected","false").attr("tabindex","-1"),e(this).addClass("active").attr("aria-selected","true").attr("tabindex","0"),e(".tab-content").removeClass("active"),e('.tab-content[data-tab="'+t+'"]').addClass("active")}),e(".tab-button").on("keydown",function(t){const i=e(".tab-button"),n=i.index(this);let r=n;switch(t.key){case"ArrowRight":case"ArrowDown":t.preventDefault(),r=(n+1)%i.length;break;case"ArrowLeft":case"ArrowUp":t.preventDefault(),r=(n-1+i.length)%i.length;break;case"Home":t.preventDefault(),r=0;break;case"End":t.preventDefault(),r=i.length-1;break;default:return}i.eq(r).focus().click()}),e('input[type="checkbox"], select').on("change",o),e("#resetBtn").on("click",function(){confirm("Êtes-vous sûr de vouloir réinitialiser tous les champs ?")&&(e('input[type="checkbox"]').prop("checked",!1),e('input[type="range"], input[type="number"].number-input').val(0),e("select").prop("selectedIndex",0),e(".client-form input").val(""),o(),e("html, body").animate({scrollTop:0},300))}),e("#downloadQuote").on("click",p),e("#printQuote").on("click",m),o()})}(jQuery);