const WEBHOOK_URL="https://ettia.app.n8n.cloud/webhook/landing-form";function trackFormSubmit(e,t){window.dataLayer.push({event:"form_submit",form_name:e,form_location:t})}function trackClickToCall(e,t){window.dataLayer.push({event:"click_to_call",phone_number:e,click_location:t})}function trackScrollMilestone(e){window.dataLayer.push({event:"scroll_milestone",scroll_percentage:e})}function trackConversion(e,t){window.dataLayer.push({event:"conversion",conversion_type:e,conversion_value:t})}async function submitFormToN8n(e,t){const n=t.querySelector('button[type="submit"]'),o=t.querySelector("#form-error")||document.getElementById("form-error"),r=n.textContent;n.textContent="Envoi en cours...",n.disabled=!0,o&&(o.style.display="none");try{if(!(await fetch(WEBHOOK_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,submitted_at:(new Date).toISOString(),page_url:window.location.href,user_agent:navigator.userAgent})})).ok)throw new Error("Erreur serveur");trackConversion("lead_form",1),window.location.href="/merci.html"}catch(e){console.error("Erreur envoi formulaire:",e),o&&(o.textContent="Une erreur est survenue. Veuillez réessayer ou nous appeler directement.",o.style.display="block"),n.textContent=r,n.disabled=!1}}if(window.dataLayer=window.dataLayer||[],document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".menu-toggle"),t=document.querySelector(".nav-menu");e&&e.addEventListener("click",function(){t.classList.toggle("active")}),document.querySelectorAll('a[href^="tel:"]').forEach(e=>{e.addEventListener("click",function(){trackClickToCall("0755188937",this.getAttribute("data-location")||"unknown")})});const n=window.location.pathname;document.querySelectorAll(".nav-menu a").forEach(e=>{const t=e.getAttribute("href");(t===n||"/"===n&&"index.html"===t||n.includes(t.replace(".html","")))&&e.classList.add("active")}),document.querySelectorAll("form[data-form-name]").forEach(e=>{e.addEventListener("submit",async function(e){e.preventDefault();const t=this.getAttribute("data-form-name"),n=this.getAttribute("data-form-location"),o={form_name:t,form_location:n};this.querySelectorAll("input, select, textarea").forEach(e=>{"checkbox"!==e.type&&e.name&&(o[e.name]=e.value||"")});const r=this.querySelectorAll('input[name="travaux"]:checked');if(r.length>0){const e=Array.from(r).map(e=>e.value);o.travaux=e.join(", ")}const i=this.querySelector('textarea[name="message"]');i&&(o.message=i.value||""),trackFormSubmit(t,n),await submitFormToN8n(o,this)})}),document.querySelectorAll("[data-toggle]").forEach(e=>{e.addEventListener("click",function(){const e=this.getAttribute("data-toggle"),t=document.getElementById(e);t&&(t.classList.toggle("hidden"),this.textContent=t.classList.contains("hidden")?"+ Ajouter des détails (optionnel)":"- Masquer les détails")})});const o=document.querySelector(".sticky-devis-btn"),r=document.querySelector(".devis-popup-overlay"),i=document.querySelector(".devis-popup-close");o&&r&&(o.addEventListener("click",function(){r.classList.add("active"),document.body.style.overflow="hidden"}),i.addEventListener("click",function(){r.classList.remove("active"),document.body.style.overflow=""}),r.addEventListener("click",function(e){e.target===r&&(r.classList.remove("active"),document.body.style.overflow="")}))}),window.location.pathname.includes("landing")){let e=!1,t=!1,n=!1,o=!1;window.addEventListener("scroll",function(){const r=window.scrollY/(document.documentElement.scrollHeight-window.innerHeight)*100;r>=25&&!e&&(trackScrollMilestone(25),e=!0),r>=50&&!t&&(trackScrollMilestone(50),t=!0),r>=75&&!n&&(trackScrollMilestone(75),n=!0),r>=95&&!o&&(trackScrollMilestone(100),o=!0)})}window.location.pathname.includes("merci")&&trackConversion("lead_form",1);let currentSlide=0;const slides=document.querySelectorAll(".slide");function showSlide(e){slides.forEach((t,n)=>{t.classList.remove("active"),n===e&&t.classList.add("active")})}function nextSlide(){currentSlide=(currentSlide+1)%slides.length,showSlide(currentSlide)}function prevSlide(){currentSlide=(currentSlide-1+slides.length)%slides.length,showSlide(currentSlide)}if(slides.length>0){showSlide(0),setInterval(nextSlide,5e3);const e=document.querySelector(".slider-next"),t=document.querySelector(".slider-prev");e&&e.addEventListener("click",nextSlide),t&&t.addEventListener("click",prevSlide)}const observerOptions={threshold:.1,rootMargin:"0px 0px -50px 0px"},observer=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("fade-in")})},observerOptions);function scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}document.querySelectorAll(".service-card, .card, .gallery-item").forEach(e=>{observer.observe(e)});